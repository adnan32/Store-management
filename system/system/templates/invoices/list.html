{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Invoices" %}{% endblock %}
{% block content %}
  <div style="margin-bottom:1rem;">
      <a href="{% url 'invoice-dashboard' %}" class="button">← {% trans "Back to dashboard" %}</a>
      <a href="{% url 'invoice-add' %}" class="button" style="margin-left:.5rem;">➕ {% trans "New invoice" %}</a>
  </div>
<h2>📑 {% trans "Invoices" %}</h2>
<form method="get" class="filters" style="margin-bottom:1rem; display:flex; gap:.5rem; flex-wrap:wrap;">
  <input type="text" name="q" placeholder="{% trans 'Search number or customer' %}"
         value="{{ request.GET.q }}" style="flex:1 1 180px;">

  <select name="customer">
      <option value="">{% trans "All customers" %}</option>
      {% for c in customers %}
        <option value="{{ c.id }}"
                {% if request.GET.customer == c.id|stringformat:"s" %}selected{% endif %}>
            {{ c.name }}
        </option>
      {% endfor %}
  </select>

  <input type="date" name="from" value="{{ request.GET.from }}">
  <input type="date" name="to"   value="{{ request.GET.to }}">

  <select name="paid">
     <option value="">{% trans "Paid & unpaid" %}</option>
     <option value="yes" {% if request.GET.paid == "yes" %}selected{% endif %}>{% trans "Paid" %}</option>
     <option value="no"  {% if request.GET.paid == "no"  %}selected{% endif %}>{% trans "Unpaid" %}</option>
  </select>

  <button class="button">{% trans "Filter" %}</button>
  {% if request.GET %}<a href="{% url 'invoice-list' %}" class="button">{% trans "Reset" %}</a>{% endif %}
</form>
<table>
  <tr><th>{% trans "No." %}</th><th>{% trans "Customer" %}</th><th>{% trans "Issue" %}</th><th>{% trans "Total" %}</th>
  <th>{% trans "Paid" %}</th><th></th></tr>
  {% for inv in object_list %}
    <tr>
      <td>{{ inv.number }}</td>
      <td>{{ inv.customer.name }}</td>
      <td>{{ inv.issue_date }}</td>
      <td>{{ inv.total_inc_vat }} kr</td>
      <td>{% if inv.paid %}✅{% else %}❌{% endif %}</td>
      <td>
        <a href="{% url 'invoice-detail' inv.pk %}" class="button">{% trans "View" %}</a>
        <a href="{% url 'invoice-delete' inv.pk %}" class="button" style="margin-left:.5rem;">🗑 {% trans "Delete" %}</a>
        <form action="{% url 'invoice-toggle-paid' inv.pk %}"
              method="post" style="display:inline;">
            {% csrf_token %}
            {% if inv.paid %}
               <button class="button is-warning" style="margin-left:.25rem;">
                   {% trans "Mark unpaid" %}
               </button>
            {% else %}
               <button class="button is-success" style="margin-left:.25rem;">
                   {% trans "Mark paid" %}
               </button>
            {% endif %}
        </form>
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="5">{% trans "No invoices yet." %}</td></tr>
  {% endfor %}
</table>
{% endblock %}
